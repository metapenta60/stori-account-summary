# Stori Account Summary

This repository contains the code to generate account summaries from transaction data stored in an S3 bucket and process them using AWS Lambda.

## Table of Contents

- [Dependencies](#dependencies)
- [Configuration](#configuration)
- [Environment Variables](#environment-variables)
- [Makefile Instructions](#makefile-instructions)
- [Usage](#usage)

## Dependencies

- Go 1.18+: This projects relies en Golang as a prgramming language. You can download Golang: https://go.dev/doc/install
- MockGen for testing: You can download it following the instructions: https://github.com/uber-go/mock
- A Sendgrid account. We rely in Sendgrid as a email provider. The SendGrid free layer allow you 100 messages/day

## Configuration

### AWS Lambda

1. Create a new Lambda function in the AWS Management Console.
2. Set the runtime to Amazon Linux 2023
3. Choose the correct arquitecture of your computer of the computer where the buil will be created.
4. Configure the triggers: The proposal was to use s3 callbacks to know when a file was uploaded and process it. To configure this trigger you have to go to Configuration > Triggers, go to Add Trigger and select S3 with the PUT events

### S3 Bucket

1. Create an S3 bucket in the AWS Management Console.
2. Upload your `transactions.csv` file to the S3 bucket.

## Environment Variables

The following environment variables are required for the Lambda function:

- `AWS_REGION`: The AWS region where your resources are located.
- `S3_BUCKET`: The name of the S3 bucket containing the `transactions.csv` file.
- `DYNAMODB_TABLE`: The name of the DynamoDB table to store transaction data.

## Makefile Instructions

The `Makefile` contains several useful commands for managing the project.

### Install Dependencies

```sh
make dependencies
```

This command will tidy up and vendor the Go modules.

Run the Application
```sh
make run
```

Run Tests
```sh
make tests
```

This command will run all the tests in the project.

## Build the Application
This command will build the Go application for Linux (required for AWS Lambda).

## Package the Application
This command will build the application and package it into a zip file for deployment to AWS Lambda.

## Generate Mocks
This command will generate the necessary mocks for testing using GoMock.

## Usage
Configure your AWS Lambda function and S3 bucket as described above.
Set the required environment variables in your Lambda function.
Upload the bootstrap.zip file generated by make package to your Lambda function.

